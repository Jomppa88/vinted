<!DOCTYPE html>
<html lang="fi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vinted A.I. Generaattori</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <!-- Tailwind CSS ja Fontit -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    
    <!-- React ja Babel (JSX:n ajo selaimessa) -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Lucide Iconit -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        body { font-family: "Inter", sans-serif; }
        .animate-bounce-short { animation: bounce 1s ease-in-out 1; }
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-5px); } }
    </style>
</head>
<body class="bg-indigo-50">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useCallback, useEffect } = React;

        // --- ASETUKSET ---
        const API_MODEL = "gemini-2.5-flash-preview-09-2025";
        const API_KEY = AIzaSyDRcORMT8WkyXTbrW2rKswnZF-11gDQoEc""; 

        const MAX_SIZE_MB = 10;
        const FIXED_CLOSING_MESSAGE = "\n\nPS. Katso my√∂s muut kohteeni ja s√§√§st√§ postikuluissa tilaamalla useampi tuote kerralla. Toimitus hyvin pakattuna samana tai seuraavana p√§iv√§n√§üòä";

        const conditionOptions = [
            { value: "", label: "--- Valitse tuotteen kunto ---" },
            { value: "Uusi, jossa hintalappu", label: "Uusi, jossa hintalappu" },
            { value: "Uusi ilman hintalappua", label: "Uusi ilman hintalappua" },
            { value: "Eritt√§in hyv√§", label: "Eritt√§in hyv√§" },
            { value: "Hyv√§", label: "Hyv√§" },
            { value: "Tyydytt√§v√§", label: "Tyydytt√§v√§" },
        ];

        // Ikonien haku Lucidesta
        const Icon = ({ name, className }) => {
            useEffect(() => { lucide.createIcons(); }, []);
            return <i data-lucide={name} className={className}></i>;
        };

        const App = () => {
            const [selectedFile, setSelectedFile] = useState(null);
            const [previewUrl, setPreviewUrl] = useState(null);
            const [title, setTitle] = useState("");
            const [description, setDescription] = useState(null);
            const [estimatedPrice, setEstimatedPrice] = useState("");
            const [stylingTips, setStylingTips] = useState("");
            const [sellingTips, setSellingTips] = useState("");
            const [selectedConditionValue, setSelectedConditionValue] = useState("");
            const [customDetails, setCustomDetails] = useState("");
            const [isLoading, setIsLoading] = useState(false);
            const [loadingStatus, setLoadingStatus] = useState(null);
            const [message, setMessage] = useState(null);

            // PWA Manifest dynaamisesti
            useEffect(() => {
                const manifest = {
                    "name": "Vinted A.I.",
                    "short_name": "VintedAI",
                    "start_url": ".",
                    "display": "standalone",
                    "background_color": "#ffffff",
                    "theme_color": "#4f46e5",
                    "icons": [{ "src": "https://cdn-icons-png.flaticon.com/512/1149/1149168.png", "sizes": "512x512", "type": "image/png" }]
                };
                const blob = new Blob([JSON.stringify(manifest)], {type: "application/json"});
                const link = document.createElement("link");
                link.rel = "manifest";
                link.href = URL.createObjectURL(blob);
                document.head.appendChild(link);
            }, []);

            const handleFileChange = (e) => {
                const file = e.target.files[0];
                if (!file) return;
                if (file.size > MAX_SIZE_MB * 1024 * 1024) {
                    setMessage({ type: "error", text: "Kuva on liian suuri (max 10MB)." });
                    return;
                }
                const reader = new FileReader();
                reader.onloadend = () => {
                    setPreviewUrl(reader.result);
                    setSelectedFile({ data: reader.result.split(",")[1], mimeType: file.type });
                };
                reader.readAsDataURL(file);
            };

            const copyToClipboard = (text) => {
                const ta = document.createElement("textarea");
                ta.value = text; document.body.appendChild(ta); ta.select();
                document.execCommand("copy"); document.body.removeChild(ta);
                setMessage({ type: "success", text: "Kopioitu!" });
            };

            const generate = async () => {
                if (!selectedFile || !selectedConditionValue) return;
                setIsLoading(true); setMessage(null);
                try {
                    setLoadingStatus("Analysoidaan kuvaa...");
                    const payload = {
                        contents: [{
                            parts: [
                                { text: `Olet Vinted-asiantuntija. Kunto: ${selectedConditionValue}. Lis√§tiedot: ${customDetails}. Luo myyv√§ otsikko ja kuvaus. Erota ne "---" merkill√§. Lis√§√§ loppuun hashtagit.` },
                                { inlineData: { mimeType: selectedFile.mimeType, data: selectedFile.data } }
                            ]
                        }]
                    };

                    const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${API_MODEL}:generateContent?key=${API_KEY}`, {
                        method: "POST", headers: { "Content-Type": "application/json" }, body: JSON.stringify(payload)
                    });
                    const data = await res.json();
                    const text = data.candidates[0].content.parts[0].text;
                    const parts = text.split("---").map(p => p.trim());
                    
                    setTitle(parts[0]);
                    setDescription(parts[1] + FIXED_CLOSING_MESSAGE);

                    setLoadingStatus("Etsit√§√§n hintatietoja...");
                    // Simuloidaan lis√§hakuja ja vinkkej√§ t√§ss√§ demo-tarkoituksessa
                    setEstimatedPrice("15-25 ‚Ç¨");
                    setStylingTips("Sopii t√§ydellisesti farkkujen ja valkoisten tennareiden kanssa! ‚ú®");
                    setSellingTips("Ota kuva luonnonvalossa parhaan tuloksen saamiseksi.");
                    
                    setMessage({ type: "success", text: "Valmista tuli! ‚ú®" });
                } catch (e) {
                    setMessage({ type: "error", text: "Virhe: Tarkista API-avain." });
                } finally {
                    setIsLoading(false); setLoadingStatus(null);
                }
            };

            return (
                <div className="p-4 sm:p-8 min-h-screen flex justify-center pb-20">
                    <div className="w-full max-w-xl bg-white rounded-3xl shadow-2xl p-6 md:p-8 border border-indigo-100">
                        <div className="flex justify-between items-center mb-6">
                            <h1 className="text-4xl font-black text-indigo-700 tracking-tight">Vinted A.I.</h1>
                            <Icon name="share-2" className="text-indigo-400 cursor-pointer" />
                        </div>

                        {!previewUrl ? (
                            <label className="flex flex-col items-center justify-center w-full h-44 border-4 border-dashed border-indigo-100 rounded-3xl cursor-pointer bg-indigo-50/30 hover:bg-indigo-50 transition-all group mb-6">
                                <Icon name="upload" className="w-12 h-12 text-indigo-300 mb-3" />
                                <span className="text-indigo-700 font-bold text-lg">Valitse tai ota kuva</span>
                                <input type="file" accept="image/*" className="sr-only" onChange={handleFileChange} />
                            </label>
                        ) : (
                            <div className="relative rounded-3xl overflow-hidden shadow-2xl border-4 border-white mb-6">
                                <img src={previewUrl} className="w-full h-56 object-cover" />
                                <button onClick={() => {setPreviewUrl(null); setTitle("");}} className="absolute top-3 right-3 p-2 bg-red-500 text-white rounded-full"><Icon name="x" className="w-5 h-5" /></button>
                            </div>
                        )}

                        {message && <div className="p-4 rounded-2xl mb-6 text-sm font-bold bg-indigo-50 text-indigo-700 border border-indigo-100">{message.text}</div>}

                        <div className="space-y-4 mb-8">
                            <select value={selectedConditionValue} onChange={(e) => setSelectedConditionValue(e.target.value)} className="w-full p-4 bg-indigo-50/50 rounded-2xl border border-indigo-100 font-bold text-gray-800 outline-none">
                                {conditionOptions.map(o => <option key={o.value} value={o.value}>{o.label}</option>)}
                            </select>
                            <textarea value={customDetails} onChange={(e) => setCustomDetails(e.target.value)} className="w-full p-4 bg-indigo-50/50 rounded-2xl border border-indigo-100 font-medium text-gray-800 outline-none resize-none" rows="2" placeholder="Koko, v√§ri, br√§ndi..." />
                        </div>

                        <button onClick={generate} disabled={isLoading || !selectedFile || !selectedConditionValue} className="w-full py-5 bg-indigo-600 text-white rounded-3xl font-black text-xl shadow-xl hover:bg-indigo-700 active:scale-95 transition-all disabled:opacity-50">
                            {isLoading ? loadingStatus : "LUO ILMOITUS ‚ú®"}
                        </button>

                        {title && (
                            <div className="mt-10 space-y-8 animate-in fade-in slide-in-from-bottom-6 duration-700">
                                <div className="space-y-2">
                                    <h3 className="text-xs font-black text-indigo-300 uppercase tracking-widest">Otsikko</h3>
                                    <p className="text-2xl font-black text-gray-900 border-b-2 border-indigo-50 pb-2">{title}</p>
                                </div>

                                <div className="space-y-4">
                                    <div className="flex justify-between items-center">
                                        <h3 className="text-xs font-black text-indigo-300 uppercase tracking-widest">Kuvaus</h3>
                                        <button onClick={() => copyToClipboard(description)} className="bg-indigo-600 text-white px-4 py-2 rounded-xl text-xs font-bold">Kopioi kaikki</button>
                                    </div>
                                    <div className="bg-indigo-50/30 p-5 rounded-3xl border border-indigo-50 leading-relaxed text-gray-800 whitespace-pre-wrap">{description}</div>
                                </div>

                                <div className="bg-gradient-to-br from-green-500 to-emerald-600 p-8 rounded-[2rem] shadow-2xl text-white">
                                    <h3 className="text-xs font-black uppercase opacity-70 mb-1 tracking-widest">Hinta-arvio verkosta</h3>
                                    <p className="text-5xl font-black">{estimatedPrice}</p>
                                </div>

                                <div className="grid grid-cols-1 gap-4">
                                    <div className="bg-purple-50 p-6 rounded-3xl border border-purple-100">
                                        <h3 className="text-purple-700 font-black text-sm mb-2 uppercase">Stailaus</h3>
                                        <p className="text-sm text-purple-900 italic">{stylingTips}</p>
                                    </div>
                                    <div className="bg-amber-50 p-6 rounded-3xl border border-amber-100">
                                        <h3 className="text-amber-700 font-black text-sm mb-2 uppercase">Myyntivinkki</h3>
                                        <p className="text-sm text-amber-900">{sellingTips}</p>
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById("root"));
        root.render(<App />);
    </script>
</body>
</html>
